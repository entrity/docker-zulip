<IfModule mod_ssl.c>
  <VirtualHost *:443>
    ServerName zulip.duckofdoom.com
    RewriteEngine On
    RewriteRule /(.*) https://duckofdoom.com/$1 [R,L]
  </VirtualHost>

  <VirtualHost *:443>
    ServerName duckofdoom.com
    RewriteEngine On

    RequestHeader set "X-Forwarded-Proto" expr=%{REQUEST_SCHEME}
    RequestHeader set Host duckofdoom.com

    Include /etc/apache2/sites-available/zulip-shared-snippet.conf

    RewriteCond %{HTTP_REFERER} ^https?://duckofdoom\.com [NC]
    RewriteRule ^/static/images/favicon.svg /var/www/zulip/pedestrian/favicon.svg [L]
    RewriteCond %{HTTP_REFERER} ^https?://duckofdoom\.com [NC]
    RewriteRule ^/static/images/favicon.png /var/www/zulip/pedestrian/favicon.png [L]
    RewriteCond %{HTTP_REFERER} ^https?://duckofdoom\.com [NC]
    RewriteRule ^/favicon.ico /var/www/zulip/pedestrian/favicon.png [L]
  </VirtualHost>

  <VirtualHost *:80>
      ServerName duckofdoom.com
      ServerAlias zulip.duckofdoom.com
      RewriteEngine On

      RewriteRule ^ https://duckofdoom.com%{REQUEST_URI} [R=301,L]
  </VirtualHost>
</IfModule>
